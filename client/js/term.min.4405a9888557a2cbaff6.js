(()=>{"use strict";let t=(t,e=500,o=0)=>{t.classList.contains("_slide")||(t.classList.add("_slide"),t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=`${t.offsetHeight}px`,t.offsetHeight,t.style.overflow="hidden",t.style.height=o?`${o}px`:"0px",t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,window.setTimeout((()=>{t.hidden=!o,!o&&t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),!o&&t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.classList.remove("_slide"),document.dispatchEvent(new CustomEvent("slideUpDone",{detail:{target:t}}))}),e))};function e(){const e=document.querySelectorAll("[data-spollers]");if(e.length>0){const o=Array.from(e).filter((function(t,e,o){return!t.dataset.spollers.split(",")[0]}));o.length&&n(o);let s=function(t,e){const o=Array.from(t).filter((function(t,o,s){if(t.dataset[e])return t.dataset[e].split(",")[0]}));if(o.length){const t=[];o.forEach((o=>{const s={},n=o.dataset[e].split(",");s.value=n[0],s.type=n[1]?n[1].trim():"max",s.item=o,t.push(s)}));let s=t.map((function(t){return"("+t.type+"-width: "+t.value+"px),"+t.value+","+t.type}));s=function(t){return t.filter((function(t,e,o){return o.indexOf(t)===e}))}(s);const n=[];if(s.length)return s.forEach((e=>{const o=e.split(","),s=o[1],a=o[2],i=window.matchMedia(o[0]),p=t.filter((function(t){if(t.value===s&&t.type===a)return!0}));n.push({itemsArray:p,matchMedia:i})})),n}}(e,"spollers");function n(t,e=!1){t.forEach((t=>{t=e?t.item:t,e.matches||!e?(t.classList.add("_spoller-init"),a(t),t.addEventListener("click",i)):(t.classList.remove("_spoller-init"),a(t,!1),t.removeEventListener("click",i))}))}function a(t,e=!0){let o=t.querySelectorAll("[data-spoller]");o.length&&(o=Array.from(o).filter((e=>e.closest("[data-spollers]")===t)),o.forEach((t=>{e?(t.removeAttribute("tabindex"),t.classList.contains("_spoller-active")||(t.nextElementSibling.hidden=!0)):(t.setAttribute("tabindex","-1"),t.nextElementSibling.hidden=!1)})))}function i(e){const o=e.target;if(o.closest("[data-spoller]")){const s=o.closest("[data-spoller]"),n=s.closest("[data-spollers]"),a=n.hasAttribute("data-one-spoller"),i=n.dataset.spollersSpeed?parseInt(n.dataset.spollersSpeed):500;n.querySelectorAll("._slide").length||(a&&!s.classList.contains("_spoller-active")&&p(n),s.classList.toggle("_spoller-active"),((e,o=500)=>{e.hidden?((t,e=500,o=0)=>{if(!t.classList.contains("_slide")){t.classList.add("_slide"),t.hidden=!t.hidden&&null,o&&t.style.removeProperty("height");let s=t.offsetHeight;t.style.overflow="hidden",t.style.height=o?`${o}px`:"0px",t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=s+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout((()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.classList.remove("_slide"),document.dispatchEvent(new CustomEvent("slideDownDone",{detail:{target:t}}))}),e)}})(e,o):t(e,o)})(s.nextElementSibling,i)),e.preventDefault()}}function p(e){const o=e.querySelector("[data-spoller]._spoller-active"),s=e.dataset.spollersSpeed?parseInt(e.dataset.spollersSpeed):500;o&&!e.querySelectorAll("._slide").length&&(o.classList.remove("_spoller-active"),t(o.nextElementSibling,s))}s&&s.length&&s.forEach((t=>{t.matchMedia.addEventListener("change",(function(){n(t.itemsArray,t.matchMedia)})),n(t.itemsArray,t.matchMedia)}));const r=document.querySelectorAll("[data-spoller-close]");r.length&&document.addEventListener("click",(function(e){e.target.closest("[data-spollers]")||r.forEach((e=>{const o=e.closest("[data-spollers]"),s=o.dataset.spollersSpeed?parseInt(o.dataset.spollersSpeed):500;e.classList.remove("_spoller-active"),t(e.nextElementSibling,s)}))}))}}class o{constructor(t,e){this.window=t,this.options=e}createWindow(t){document.querySelector(".wrapper").insertAdjacentHTML("beforeend",`<div data-popup class="popup">\n            <div class="popup__body">\n                <div class="popup__content">\n                ${t}\n                </div>\n                <button data-popup-remove class="popup__btn-remove _icon-cross"></button>\n            </div>\n        </div>`),this.window=document.querySelector(".wrapper").lastElementChild}getDataAttribute(t){return this.window.querySelector(`[data-popup-item="${t}"]`)}infoTable(t){const e=localStorage.getItem("lang");"success"===t&&document.querySelector("[data-popup-list]").insertAdjacentHTML("beforeend","uk"===e?'<li class="popup-info__item">Успішно виконано</li>':'<li class="popup-info__item">Successfully completed</li>'),"error"===t?document.querySelector("[data-popup-list]").insertAdjacentHTML("beforeend","uk"===e?'<li class="popup-info__item popup-info__item_error">Помилка при заповненні</li>':'<li class="popup-info__item popup-info__item_error">Error filling in</li>'):console.log(t)}}class s extends o{constructor(t,e){super(t,e)}findObjAndString(t,e,o,s=""){const n=t.findIndex((t=>t[e]===o));if(-1===n)return null;if(!s)return[n];const a=t[n].foodDates.findIndex((t=>t.includes(s)));return-1===a?null:[n,a]}getGroupShop(){try{return Object.entries(this.options.shop.reduce(((t,{category:e,address:o})=>(t[e]=t[e]||[],t[e].push(o),t)),{})).map((([t,e])=>`<optgroup label="${t}">${e.map(((t,e)=>`<option value="${e+1}">${t}</option>`)).join("")}</optgroup>`)).join("")}catch(t){return""}}getGroupFood(){try{return this.options.food.map((({foodType:t,foodName:e})=>`<optgroup label="${t}">${e.map(((t,e)=>`<option value="${e+1}">${t}</option>`)).join("")}</optgroup>`)).join("")}catch(t){return""}}getGroupShopType(){try{return this.options.shopType.map((({name:t},e)=>`<option value="${e+1}">${t}</option>`)).join("")}catch(t){return""}}getGroupFoodType(){try{return this.options.food.map((({foodType:t},e)=>`<option value="${e+1}">${t}</option>`)).join("")}catch(t){return""}}apdateForm(){const t=document.querySelectorAll('[data-popup-item="shop"]'),e=document.querySelectorAll('[data-popup-item="food"]'),o=document.querySelectorAll('[data-popup-item="shopType"]'),s=document.querySelectorAll('[data-popup-item="foodType"]');t.forEach((t=>{"SELECT"===t.tagName&&(t.innerHTML=`<option value="0">- ---- -</option>${this.getGroupShop()}`)})),e.forEach((t=>{"SELECT"===t.tagName&&(t.innerHTML=`<option value="0">- ---- -</option>${this.getGroupFood()}`)})),o.forEach((t=>{"SELECT"===t.tagName&&(t.innerHTML=`<option value="0">- ---- -</option>${this.getGroupShopType()}`)})),s.forEach((t=>{"SELECT"===t.tagName&&(t.innerHTML=`<option value="0">- ---- -</option>${this.getGroupFoodType()}`)}))}validateFields(t){let e=!1;for(const o of t){const t=this.getDataAttribute(o);t&&t.value.trim()&&"0"!==t.value.trim()?(t.classList.remove("_popup-error"),t.previousElementSibling.classList.remove("_popup-error")):(t.classList.add("_popup-error"),t.previousElementSibling.classList.add("_popup-error"),e=!0)}return!e||(console.log("error"),this.infoTable("error"),!1)}}const n=class{constructor(t,e,o,s){this.croppieInstance=null,this.vph=e,this.vpw=t,this.bdh=s,this.bdw=o}init(){document.querySelector("[data-img-btn]").addEventListener("click",(t=>{document.querySelector("[data-img-file]").click()})),document.querySelector("[data-img-file]").addEventListener("change",(t=>{const e=new FileReader;e.onload=t=>{this.croppieInstance=this.initializeCroppie(),this.croppieInstance.bind({url:t.target.result}).then((()=>{console.log("Зображення успішно завантажено та прив'язано.")})).catch((t=>{console.error("Помилка при прив'язуванні зображення: ",t)}))},e.readAsDataURL(t.target.files[0])}))}initializeCroppie(){const t=document.querySelector("[data-img-container]");return this.croppieInstance&&(this.croppieInstance.destroy(),t.innerHTML=""),this.croppieInstance=new Croppie(t,{viewport:{width:this.vpw,height:this.vph,type:"square"},boundary:{width:this.bdw,height:this.bdh},showZoomer:!1,enableOrientation:!0}),this.croppieInstance}async saveImg(){if(this.croppieInstance)try{const t=await this.croppieInstance.result({type:"base64",size:{width:this.bdw,height:this.bdh}}),e=new Blob([new Uint8Array(atob(t.split(",")[1]).split("").map((t=>t.charCodeAt(0))))],{type:"image/webp"}),o=new File([e],"cropped-image.webp",{type:"image/webp"}),s=new FormData;s.append("image",o);const n=await fetch("https://pp-mk.onrender.com/upload/pic",{method:"POST",body:s});return(await n.json()).link}catch(t){return console.error("Помилка: ",t),!1}}};class a extends s{constructor(t,e){super(t,e)}confirmWindow(){if(!this.validateFields(["shop","food","date"]))return!1;const t=this.getDataAttribute("shop").options[this.getDataAttribute("shop").selectedIndex].text.trim(),e=this.getDataAttribute("food").options[this.getDataAttribute("food").selectedIndex].text.trim(),o=this.getDataAttribute("date").value.trim(),s=this.findObjAndString(this.options.shop,"address",t,e);if(s)this.options.shop[s[0]].foodDates[s[1]]=`${e}, ${o}`;else{const s=this.findObjAndString(this.options.shop,"address",t);this.options.shop[s[0]].foodDates.push(`${e}, ${o}`)}return this.infoTable("success"),!0}createForm(){const t=`<h4 class="popup__title">Добавити дату</h4>\n        <p class="popup__text">*Оберіть магазин</p>\n        <select data-popup-item="shop" class="popup__select">\n            <option value="0">- ---- -</option>\n            ${this.getGroupShop()}\n        </select>\n        <p class="popup__text popup__text_center">або</p>\n        <button data-btn="shop" class="popup__btn-confirm">Добавити магазин</button>\n        <p class="popup__text">*Оберіть продукт</p>\n        <select data-popup-item="food" class="popup__select">\n            <option value="0">- ---- -</option>\n            ${this.getGroupFood()}\n        </select>\n        <p class="popup__text popup__text_center">або</p>\n        <button data-btn="food" class="popup__btn-confirm">Добавити продукт</button>\n        <div class="popup__form-group">\n            <p class="popup__text">*Вкажіть кінцеву дату</p>\n            <input data-popup-item="date" type="date" class="popup__input">\n        </div>\n        <div class="popup__form-group">\n            <button data-popup-btn="saveDate" class="popup__btn-confirm popup__btn-confirm_save">Добавити</button>\n        </div>`;this.createWindow(t,"date")}}class i extends s{constructor(t,e){super(t,e)}confirmWindow(){if(!this.validateFields(["shopType","shop"]))return!1;const t=this.getDataAttribute("shopType").options[this.getDataAttribute("shopType").selectedIndex].text.trim(),e=this.getDataAttribute("shop").value.trim();return this.findObjAndString(this.options.shopType,"name",t)?(this.options.shop.push({address:`${e}`,category:`${t}`,foodDates:[]}),this.apdateForm(),this.infoTable("success"),!0):void 0}createForm(){const t=`<h4 class="popup__title">Добавити магазин</h4>\n        <p class="popup__text">Оберіть мережу</p>\n        <select data-popup-item="shopType" data-popup-item="shopType" class="popup__select">\n            <option value="0">- ---- -</option>\n            ${this.getGroupShopType()}\n        </select>\n        <p class="popup__text popup__text_center">або</p>\n        <button data-btn="shopType" class="popup__btn-confirm">Добавити мережу</button>\n        <div class="popup__form-group">\n            <p class="popup__text">Вкажіть назву магазина</p>\n            <input data-popup-item="shop" data-popup-item="shop" type="text" class="popup__input">\n        </div>\n        <div class="popup__form-group">\n            <button data-popup-btn="saveShop" class="popup__btn-confirm popup__btn-confirm_save">Добавити</button>\n        </div>`;this.createWindow(t)}}class p extends s{constructor(t,e){super(t,e)}confirmWindow(){if(!this.validateFields(["foodType","food"]))return!1;const t=this.getDataAttribute("foodType").options[this.getDataAttribute("foodType").selectedIndex].text.trim(),e=this.getDataAttribute("food").value.trim(),o=this.findObjAndString(this.options.food,"foodType",t);return o?(this.options.food[o[0]].foodName.push(e),this.apdateForm(),this.infoTable("success"),!0):void 0}createForm(){const t=`<h4 class="popup__title">Добавити продукт</h4>\n        <p class="popup__text">Оберіть категорію продукції</p>\n        <select data-popup-item="foodType" class="popup__select">\n            <option value="0">- ---- -</option>\n            ${this.getGroupFoodType()}\n        </select>\n        <p class="popup__text popup__text_center">або</p>\n        <button data-btn="foodType" class="popup__btn-confirm">Добавити тип продукції</button>\n        <div class="popup__form-group">\n            <p class="popup__text">Вкажіть назву продукції</p>\n            <input data-popup-item="food" type="text" class="popup__input">\n        </div>\n        <div class="popup__form-group">\n            <button data-popup-btn="saveFood" class="popup__btn-confirm popup__btn-confirm_save">Добавити</button>\n        </div>`;this.createWindow(t)}}class r extends s{constructor(t,e){super(t,e)}async confirmWindow(){if(!this.validateFields(["shopType"]))return!1;const t=this.getDataAttribute("shopType").value.trim(),e=await this.img.saveImg()||null;return this.options.shopType.push({img:e,name:`${t}`}),this.apdateForm(),this.infoTable("success"),!0}createForm(){this.img=new n(200,200,300,300),this.createWindow('<h4 class="popup__title">Добавити мережу</h4>\n        <p class="popup__text">Оберіть фотографію для візуалізації мережі</p>\n        <div data-img class="img">\n            <div class="img__wrapper">\n                <div data-img-container class="img__content"></div>\n            </div>\n            <input data-img-file class="img__file" type="file" accept="image/*">\n            <button data-img-btn class="img__btn">Завантажити фото</button>\n        </div>\n        <div class="popup__form-group">\n            <p class="popup__text">Вкажіть назву мережі</p>\n            <input data-popup-item="shopType" type="text" class="popup__input">\n        </div>\n        <div class="popup__form-group">\n            <button data-popup-btn="saveShopType" class="popup__btn-confirm popup__btn-confirm_save">Добавити</button>\n        </div>'),this.img.init()}}class d extends s{constructor(t,e){super(t,e)}confirmWindow(){if(!this.validateFields(["foodType"]))return!1;const t=this.getDataAttribute("foodType").value.trim();return this.options.food.push({foodType:`${t}`,foodName:[]}),this.apdateForm(),this.infoTable("success"),!0}createForm(){this.createWindow('<h4 class="popup__title">Добавити категорію</h4>\n        <div class="popup__form-group">\n            <p class="popup__text">*Вкажіть назву категорії продукції</p>\n            <input data-popup-item="foodType" type="text" class="popup__input">\n        </div>\n        <div class="popup__form-group">\n            <button data-popup-btn="saveFoodType" class="popup__btn-confirm popup__btn-confirm_save">Добавити</button>\n        </div>')}}class l extends o{constructor(t,e){super(t,e)}createForm(t){try{const o=t.getAttribute("data-history-index"),s=this.options.shop[o].foodDates;let n=`<h4 class="popup__title">${this.options.shop[o].address}</h4>`;this.options.food.forEach((t=>{n+=this.createFoodSection(t.foodType,t.foodName,s,o)})),this.createWindow(n),e()}catch(t){console.log(t)}}createFoodSection=(t,e,o,s)=>{let n="";return e.forEach((t=>{const e=o.findIndex((e=>e.includes(t)));n+=-1!==e?this.createAvailableFoodHTML(t,s,e):this.createUnavailableFoodHTML(t,s)})),`<div data-spollers class="popup__spoller">\n                                <div data-spoller class="popup__title popup__title_spoller _icon-angle-right">${t}</div>\n                                <div class="popup__items">\n                                ${n}\n                                </div>\n                            </div>`};createAvailableFoodHTML=(t,e,o)=>`<div data-food="${e},${o}" class="date">\n                    <div class="date__container">\n                        <div class="date__content">\n                            <p data-food-name class="date__title date__green">${t}</p>\n                            <div class="date__info">\n                                <p class="date__text">Залишилось</p>\n                                <p data-food-days class="date__text date__green">${(new Date(this.options.shop[e].foodDates[o].split(",")[1]).setHours(0,0,0,0)-new Date(this.getDate()).setHours(0,0,0,0))/864e5}</p>\n                                <p class="date__text">днів</p>\n                            </div>\n                        </div>\n                        <div class="date__btns">\n                            <button data-food-btn="removeFood" type="button" class="date__btn date__btn_remove _icon-plus"></button>\n                            <button data-food-btn="foodInfo" type="button" class="date__btn _icon-info"></button>\n                        </div>\n                    </div>\n                </div>`;createUnavailableFoodHTML=(t,e)=>`<div data-food="${e},-1" class="date popup__red">\n                    <div class="date__container">\n                        <div class="date__content">\n                            <p data-food-name class="date__title date__green">${t}</p>\n                        </div>\n                        <div class="date__btns">\n                            <button data-food-btn="foodInfo" type="button" class="date__btn _icon-info"></button>\n                        </div>\n                    </div>\n                </div>`;getDate(){const t=new Date;return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}}class c extends o{constructor(t,e){super(t,e),this.indexShop,this.indexFood,this._foodName,this.foodDays,this.isHistory,this.target}createForm(t){try{let e;this.setConfig(t),e=this.indexFood>-1?this.getDate("dateFromShop"):this.getDate("todayDate");const o=`<h4 class="popup__title">Інформація про продукт</h4>        \n                        <div class="popup__form-group">\n                        <p class="popup__text">Магазин: ${this.address}</p>\n                        <p class="popup__text">Продукт: ${this.foodName}</p>\n                        <div class="popup__form-group">\n                            <p class="popup__text">Кінцева дата:</p>\n                            <input data-popup-item="date" type="date" value="${e}" class="popup__input">\n                        </div>\n                            <button data-popup-btn="changeDate" class="popup__btn-confirm popup__btn-confirm_save">Добавити</button>\n                        </div>`;this.createWindow(o)}catch(t){return this.target.remove(),!1}}confirmWindow(){const t=this.getDataAttribute("date").value.trim();if(this.indexFood<=-1)return this.newFoodInShopList=`${this.foodName}, ${t}`,this.target.setAttribute("data-food",`${this.indexShop},${this.lastFoodIndex}`),this.indexFood=this.lastFoodIndex,this.target.classList.remove("popup__red"),this._foodName.insertAdjacentHTML("afterend",`<div class="date__info">\n                                                <p class="date__text">Залишилось</p>\n                                                <p data-food-days="" class="date__text date__green">${this.getDate("daysLeft")}</p>\n                                                <p class="date__text">днів</p>\n                                            </div>`),this.target.querySelector("[data-food-btn]").insertAdjacentHTML("beforebegin",'\n                <button data-food-btn="removeFood" type="button" class="date__btn date__btn_remove _icon-plus"></button>'),void this.infoTable("success");this.changeFoodInShopList=`${this.foodName}, ${t}`,this.foodDays.innerText=`${this.getDate("daysLeft")}`,this.infoTable("success")}removeItem(t){this.setConfig(t),this.options.shop[this.indexShop].foodDates.splice(this.indexFood,1);const e=this.target.getAttribute("data-food");document.querySelectorAll(`[data-food="${e}"]`).forEach((t=>{const e=t.parentElement;let o,s;e.classList.contains("shop__dates")&&t.remove(),e.querySelectorAll("[data-food]").forEach((t=>{o=t.getAttribute("data-food").split(","),s=o[1],s>this.indexFood&&s--,t.setAttribute("data-food",`${o[0]},${s}`)}))})),this.isHistory?(this.target.classList.add("popup__red"),this.foodDays.parentElement.remove(),this.target.querySelector('[data-food-btn="removeFood"]').remove(),t.setAttribute("data-food",`${this.indexShop},-1`)):this.target.remove(),this.infoTable("success")}get address(){return this.indexShop?this.options.shop[this.indexShop].address:(console.log("Не визначено індекс магазину"),null)}get foodName(){return this._foodName.innerText.trim()}get lastFoodIndex(){return this.indexShop?this.options.shop[this.indexShop].foodDates.length-1:(console.log("Не визначено індекс магазину"),null)}set newFoodInShopList(t){this.indexShop&&t?this.options.shop[this.indexShop].foodDates.push(t):console.log("Не визначено індекс магазину")}set changeFoodInShopList(t){this.indexShop&&t?this.options.shop[this.indexShop].foodDates[this.indexFood]=t:console.log("Не визначено індекс магазину")}setConfig(t){const e=t.getAttribute("data-food");this.indexShop=e.split(",")[0],this.indexFood=e.split(",")[1],this._foodName=t.querySelector("[data-food-name]"),this.foodDays=t.querySelector("[data-food-days]"),this.isHistory=!!t.closest("[data-popup]"),this.target=t}getDate(t){if("dateFromShop"===t)return(this.indexFood>-1||this.indexShop>-1)&&this.options.shop[this.indexShop].foodDates[this.indexFood].split(",")[1].trim();const e=new Date,o=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return"todayDate"===t?`${o}-${s}-${n}`:"daysLeft"===t?(new Date(this.options.shop[this.indexShop].foodDates[this.indexFood].split(",")[1]).setHours(0,0,0,0)-new Date(this.getDate("todayDate")).setHours(0,0,0,0))/864e5:(console.log(`getDate отримано невідоме значення ${t}`),!1)}}class u extends o{constructor(t,e){super(t,e)}createForm(t){try{const e=t.getAttribute("data-btn");let o="",s="";"deleteShops"===e&&(o='<h4 class="popup__title">Магазини</h4>',this.options.shop.forEach(((t,e)=>{s+=`<button data-remove="shop,${e}" class="popup__btn-delete _icon-plus">${t.address}</button>`}))),"deleteShopTypes"===e&&(o='<h4 class="popup__title">Мережі</h4>',this.options.shopType.forEach(((t,e)=>{s+=`<button data-remove="shopType,${e}" class="popup__btn-delete _icon-plus">${t.name}</button>`}))),"deleteFoodTypes"===e&&(o='<h4 class="popup__title">Категорії</h4>',this.options.food.forEach(((t,e)=>{s+=`<button data-remove="food,${e}" class="popup__btn-delete _icon-plus">${t.foodType}</button>`}))),this.createWindow(o+s)}catch(t){console.log(t)}}removeItem(t){const e=t.getAttribute("data-remove").split(","),o=t.parentElement,s=e[1];o.querySelectorAll("[data-remove]").forEach((t=>{let o=t.getAttribute("data-remove").split(",")[1];s<o&&(o--,t.setAttribute("data-remove",`${e[0]},${o}`))})),"shop"===e[0]&&document.querySelectorAll(".shop__title").forEach((t=>{t.innerText===this.options.shop[e[1]].address&&t.closest(".shop").remove()})),this.options[e[0]].splice(e[1],1),t.remove()}}const h={};class _{async getData(){try{const t=await fetch("https://pp-mk.onrender.com/term/load",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw await t.json();const e=await t.json();Object.assign(h,e.store)}catch(t){console.log(t),"unauthorizedUser"!==t.type&&"notFind"!==t.type&&"oldData"!==t.type||alert("Неавторизований користувач"),h.shop||(h.shop=[]),h.shopType||(h.shopType=[]),h.food||(h.food=[])}}async loadPage(){try{const t=JSON.parse(sessionStorage.getItem("store"));if(t?Object.assign(h,t):await this.getData(),h?.shop){let t="";h?.shop.forEach(((e,o)=>{t+=`<li class="app-menu__item _icon-angle-right"><button data-history-index="${o}" data-btn="shopList" class="app-menu__btn">${e.address}</button></li>`})),t||(t='<li class="app-menu__item">Відсутні магазини</li>'),document.querySelector("[data-history]").insertAdjacentHTML("beforeend",t),this.loadSuitableTerms()}e()}catch(t){console.log(t.message)}}async saveData(){try{const t=await fetch("https://pp-mk.onrender.com/term/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!t.ok)throw await t.json();alert("Дані збережено")}catch(t){console.log(t.message)}}loadSuitableTerms(){const t=document.querySelector(".main__shops");let e="";h.shop.forEach(((t,o)=>{const s=t.category,n=h?.shopType.find((t=>t?.name===s)),a=n?n.img:"../img/terms/empty.jpg",i=function(t,e){let o="",s=17;return t.foodDates.forEach(((t,n)=>{const a=t.split(",");let i=function(t){const e=new Date(t)-new Date;return Math.ceil(e/864e5)}(a[1]);i<17&&(o+=`<li data-food="${e},${n}" class="shop__date date">\n                                        <div class="date__container">\n                                            <div class="date__content">\n                                                <p data-food-name="" class="date__title date__green">${a[0]}</p>\n                                                <div class="date__info">\n                                                    <p class="date__text">Залишилось</p>\n                                                    <p data-food-days="" class="date__text date__green">${i}</p>\n                                                    <p class="date__text">днів</p>\n                                                </div>\n                                            </div>\n                                            <div class="date__btns">\n                                                <button data-food-btn="removeFood" type="button" class="date__btn date__btn_remove _icon-plus"></button>\n                                                <button data-food-btn="foodInfo" type="button" class="date__btn _icon-info"></button>\n                                            </div>\n                                        </div>\n                                    </li>`,s>i&&(s=i))})),[o,s]}(t,o);i[1]>=17||(e+=`<div data-spollers class="main__shop shop">\n                        \x3c!-- Logo --\x3e\n                        <div class="shop__pic">\n                            <img loading="lazy" src="${a}" alt="shop type" class="shop__img">\n                        </div>\n                        \x3c!-- Description of shop--\x3e\n                         <div class="shop__content">\n                             <h3 class="shop__title">${t.address}</h3>\n                             <div class="shop__text">\n                                <span class="shop__span">Найблища дата</span>\n                                <span class="shop__span shop__span_weight">${i[1]}</span>\n                                <span class="shop__span">днів</span>\n                             </div>\n                         </div>\n                        <button data-spoller class="shop__btn-spoller _icon-angle-right">Детальніше</button>\n                        \x3c!-- Dates container--\x3e\n                        <ul class="shop__dates">             \n                        ${i[0]}\n                        </ul>\n                    </div>`)})),t.insertAdjacentHTML("beforeend",e)}checkSessionStorage(){sessionStorage.getItem("store")?(document.querySelector('[data-btn="saveOnServer"]').classList.add("_active-save"),document.querySelector('[data-btn="saveOnServer"]').disabled=!1):(document.querySelector('[data-btn="saveOnServer"]').classList.remove("_active-save"),document.querySelector('[data-btn="saveOnServer"]').disabled=!0)}}document.addEventListener("DOMContentLoaded",(t=>{const e=new _;e.loadPage(),e.checkSessionStorage();const o=new a(null,h),s=new i(null,h),n=new p(null,h),m=new r(null,h),f=new d(null,h),g=new l(null,h),v=new c(null,h),y=new u(null,h);document.addEventListener("click",(t=>{const o=t.target;if(o.closest("[data-menu-btn]")&&(document.querySelector("[data-menu]").classList.toggle("_active-menu"),o.closest("[data-menu-btn]").classList.toggle("_active-menu"),document.body.classList.toggle("_dark-bg")),o.closest("[data-btn]")){const t=o.closest("[data-btn]").getAttribute("data-btn");t&&b[t]&&(b[t](o.closest("[data-btn]")),e.checkSessionStorage())}if(o.closest("[data-popup-remove]")&&o.closest("[data-popup]").remove(),o.closest("[data-popup-btn]")){const t=o.closest("[data-popup-btn]").getAttribute("data-popup-btn"),s=o.closest("[data-popup-btn]");t&&b[t]&&(b[t](s),e.checkSessionStorage())}if(o.closest("[data-food-btn]")){const t=o.closest("[data-food-btn]").getAttribute("data-food-btn"),s=o.closest("[data-food]");t&&b[t]&&(b[t](s),e.checkSessionStorage())}o.closest("[data-remove]")&&(b.removeElement(o.closest("[data-remove]")),e.checkSessionStorage())}));const b={date:()=>o.createForm(),shop:()=>s.createForm(),food:()=>n.createForm(),shopType:()=>m.createForm(),foodType:()=>f.createForm(),saveDate:()=>{o.confirmWindow(),sessionStorage.setItem("store",JSON.stringify(h))},saveShop:()=>{s.confirmWindow(),sessionStorage.setItem("store",JSON.stringify(h))},saveFood:()=>{n.confirmWindow(),sessionStorage.setItem("store",JSON.stringify(h))},saveShopType:async()=>{await m.confirmWindow(),sessionStorage.setItem("store",JSON.stringify(h)),e.checkSessionStorage()},saveFoodType:()=>{f.confirmWindow(),sessionStorage.setItem("store",JSON.stringify(h))},shopList:t=>g.createForm(t),foodInfo:t=>v.createForm(t),changeDate:()=>{v.confirmWindow(),sessionStorage.setItem("store",JSON.stringify(h))},removeFood:t=>{v.removeItem(t),sessionStorage.setItem("store",JSON.stringify(h))},deleteShops:t=>y.createForm(t),deleteShopTypes:t=>y.createForm(t),deleteFoodTypes:t=>y.createForm(t),deleteFoods:t=>y.createForm(t),removeElement:t=>{y.removeItem(t),sessionStorage.setItem("store",JSON.stringify(h))},removeShopType:t=>{y.removeItem(t),sessionStorage.setItem("store",JSON.stringify(h))},saveOnServer:async()=>{await e.saveData(),sessionStorage.clear(),e.checkSessionStorage()}}}))})();